# 产品需求文档 (PRD): "Yusi - 灵魂叙事" (v3.0)

## 项目
Yusi (v3.0) - Soul Graph

## 核心愿景
从"向量检索"进化到"图谱理解"。在 v1.0 验证了核心价值（情景室+日记）、v2.0 实现了社区化（灵魂广场）与极致隐私（密室）之后，v3.0 将通过 **GraphRAG 知识图谱技术**重构 AI 的"记忆"与"理解"能力，让 AI 真正"读懂"用户的人生故事，实现从"语义相似匹配"到"关系推理理解"的跨越。

---

## 1. 🎯 v3.0 战略目标

*   **深度理解 (Deep Understanding)**: 引入 GraphRAG，将用户日记从"文本碎片"转化为"人生图谱"，让 AI 能进行多跳推理。
*   **AI进化 (AI Evolution)**: 升级"AI知己"为具有记忆、性格、成长轨迹的"灵魂伴侣"，实现真正的陪伴感。
*   **创作者生态 (Creator Ecosystem)**: 开放场景创作平台，让用户成为内容生产者，构建 UGC 生态闭环。
*   **跨维度连接 (Cross-Dimension Connection)**: 支持群体灵魂匹配，让志同道合的灵魂形成"灵魂部落"。

---

## 2. 🚀 新增功能范围 (New Epics)

### Epic 5: "时空足迹" (Spatial Narrative) - Geo-Context
**PM目标**: 引入地理位置维度，支持地图选点与常用位置，为 GraphRAG 提供关键的空间上下文。这不仅仅是记录地点，更是将人生故事锚定在物理世界中，辅助 AI 理解"人-地"关系。

| ID | 功能特性 | 描述 | 优先级 | 状态 |
| :--- | :--- | :--- | :--- | :--- |
| **F5.1** | 日记地理关联 | 支持写日记时添加地理位置（自动定位/地图选点/搜索POI），将故事锚定在地图上。 | P0 | [已完成] |
| **F5.2** | 常用与重要地点 | 用户可管理"常用地点"（家、公司）及定义"重要地点"（如：初恋的地方、常去的咖啡馆），辅助实体关系构建与消歧。 | P0 | [已完成] |
| **F5.3** | 足迹地图 | 在地图上可视化的展示用户日记足迹，支持按时间、地点、情感维度聚类查看过往记忆。 | P1 | [已完成] |

### Epic 6: "人生图谱" (Life Graph) - 基于 GraphRAG
**PM目标**: 利用知识图谱技术，让 AI 真正理解用户的人生故事，而非仅做语义检索。

| ID | 功能特性 | 描述 | 优先级 | 状态 |
| :--- | :--- | :--- | :--- | :--- |
| **F6.1** | 实体自动抽取 | AI 从日记中自动提取关键实体（人物、地点、事件、情绪、物品等），构建用户专属知识图谱。 | P1 | [待开发] |
| **F6.2** | 关系图谱构建 | 基于实体间的共现和语义分析，自动推断并建立关系边（如：与某人的关系、事件的因果链）。 | P1 | [待开发] |
| **F6.3** | 多跳推理问答 | AI 可回答复杂问题，如"我和小明是怎么认识的？后来发生了什么？"，通过图谱遍历进行多跳推理。 | P1 | [待开发] |
| **F6.4** | 人生时间线 | 可视化展示用户人生重要节点的时间线，基于图谱自动聚类生成"人生章节"。 | P2 | [待开发] |
| **F6.5** | 社区洞察 | 通过图聚类算法（Leiden/Louvain），识别用户生活中的"社区"（如：工作圈、朋友圈、家庭），分别理解不同圈层的故事。 | P2 | [待开发] |
| **F6.6** | 情感图谱 | 追踪用户情绪随时间和事件的变化，识别情绪触发点（如"每次提到某人情绪都变差"）。 | P2 | [待开发] |

#### GraphRAG 技术细节 (无需变动)
*(见下文架构部分，逻辑继承)*

### Epic 7: "灵魂伴侣 2.0" (Evolved AI Companion)
**PM目标**: 将 AI 从"分析工具"升级为具有个性与成长的"灵魂伴侣"。

| ID | 功能特性 | 描述 | 优先级 | 状态 |
| :--- | :--- | :--- | :--- | :--- |
| **F7.1** | 伴侣人设 | 用户可选择或自定义 AI 伴侣的性格基调（如：温暖治愈型、理性分析型、幽默调侃型等），AI 将以此风格进行所有互动。 | P1 | [待开发] |
| **F7.2** | 记忆殿堂 | AI 拥有可视化的"记忆殿堂"，基于人生图谱展示与用户的互动时间线、关键记忆节点、情感变化曲线。 | P1 | [待开发] |
| **F7.3** | 成长轨迹 | AI 伴侣拥有"成长值"系统，随互动深度提升解锁新能力（如：主动关怀、周期性情感总结、节日祝福等）。 | P2 | [待开发] |
| **F7.4** | 主动关怀 | AI 基于情感图谱的变化趋势，在检测到持续负面情绪时主动发起温暖对话，而非被动等待用户。 | P2 | [待开发] |
| **F7.5** | 周期报告 | AI 每周/每月自动生成"灵魂报告"，基于图谱分析生成情绪波动图、关键事件回顾、人际关系变化、成长建议等。 | P2 | [待开发] |
| **F7.6** | 纪念日提醒 | AI 从图谱中识别重要纪念日（生日、纪念日、重要事件周年），主动送上关怀与回忆。 | P2 | [待开发] |

### Epic 8: "场景工坊" (Scenario Workshop)
**PM目标**: 构建 UGC 创作者生态，让社区内容自我生长。

| ID | 功能特性 | 描述 | 优先级 | 状态 |
| :--- | :--- | :--- | :--- | :--- |
| **F8.1** | 场景创作器 | 提供可视化场景创作工具，用户可定义场景标题、背景描述、预设选项、分析维度等。支持富文本和配图。 | P1 | [待开发] |
| **F8.2** | 创作者认证 | 优质创作者可申请认证，获得专属标识。认证场景优先展示，创作者可获得"灵感值"奖励。 | P2 | [待开发] |
| **F8.3** | 场景评分系统 | 用户完成场景后可对场景进行评分与评价，高分场景进入"精选榜单"。 | P2 | [待开发] |
| **F8.4** | 场景系列 | 创作者可创建"场景系列"，形成有主题的场景合集（如：职场困境系列、亲密关系系列）。 | P2 | [待开发] |
| **F8.5** | 创作激励 | 引入"灵感值"虚拟货币，用户使用场景时消耗灵感值，创作者获得对应收益。可用于解锁高级功能。 | P2 | [待开发] |

### Epic 9: "灵魂部落" (Soul Tribe)
**PM目标**: 超越 1v1 匹配，构建志趣相投的小群体社交。

| ID | 功能特性 | 描述 | 优先级 | 状态 |
| :--- | :--- | :--- | :--- | :--- |
| **F9.1** | 部落创建 | 用户可创建"灵魂部落"（3-20人），设定部落主题（如：夜猫子互助会、社恐康复联盟）。 | P1 | [待开发] |
| **F9.2** | 部落匹配 | 系统基于用户的人生图谱画像，推荐适合加入的部落。用户可申请加入，部落成员投票决定是否接纳。 | P2 | [待开发] |
| **F9.3** | 部落情景室 | 部落成员可发起专属情景室活动，增强群体凝聚力。 | P2 | [待开发] |
| **F9.4** | 匿名树洞 | 部落内设"匿名树洞"，成员可匿名倾诉，其他成员匿名回应支持。 | P2 | [待开发] |
| **F9.5** | 部落成长 | 部落拥有等级系统，随活跃度提升可解锁更多功能（增加人数上限、专属场景等）。 | P2 | [待开发] |

---

## 3. 🛠 现有功能优化 (Optimizations)

### 3.1 灵魂匹配升级（基于 GraphRAG）
*   **图谱相似度匹配**: 匹配算法从"日记向量相似度"升级为"图谱结构相似度"，考虑用户的人际关系模式、情感经历类型等深层特征。 `[待开发]`
*   **匹配理由可视化**: 向用户展示 AI 推荐的"图谱连接点"，如"你们都经历过异地恋的考验"。 `[待开发]`

### 3.2 情景室优化
*   **实时进度可视化**: 在等待其他成员提交时，显示每个成员的提交状态（已提交/输入中/未开始），增加参与感。 `[待开发]`
*   **历史回顾增强**: 历史记录页面支持按场景类型、时间范围、参与人数等维度筛选。 `[待开发]`
*   **分享卡片**: 生成可分享的精美分析报告卡片（隐藏敏感内容），支持分享至社交平台。 `[待开发]`

### 3.3 灵魂广场优化
*   **话题标签**: 引入话题标签系统，用户可为投稿添加标签，支持按标签浏览。 `[待开发]`
*   **定时投稿**: 用户可设定日记在未来某个时间自动投稿到广场（如：毕业时公开高中日记）。 `[待开发]`
*   **共鸣者可见**: 对某篇内容"共鸣"后，可看到其他共鸣者的匿名画像，促进深层连接。 `[待开发]`

### 3.4 隐私与安全增强
*   **密钥助记词**: 自定义密钥模式下，支持生成12词助记词备份密钥，降低遗忘风险。 `[待开发]`
*   **紧急销毁**: 提供"紧急销毁"功能，一键删除所有数据（包括图谱），适用于极端隐私需求场景。 `[待开发]`
*   **图谱隐私**: 人生图谱仅在服务端处理，不同步至客户端；自定义密钥模式下，图谱也受密钥保护。 `[待开发]`

### 3.5 性能与体验优化
*   **离线模式**: 支持离线撰写日记，上线后自动同步。 `[待开发]`
*   **多端同步**: 提供移动端 APP（PWA），实现日记、聊天记录的多端无缝同步。 `[待开发]`
*   **夜间模式增强**: 支持自动切换夜间模式（跟随系统/定时切换），减少视觉疲劳。 `[已完成]`

---

## 4. 📐 技术架构升级

### 4.1 GraphRAG 架构设计

```
                           ┌─────────────────────────────────────────┐
                           │           用户日记输入                    │
                           └───────────────┬─────────────────────────┘
                                           ↓
                    ┌──────────────────────┴──────────────────────┐
                    ↓                                              ↓
         ┌─────────────────────┐                      ┌─────────────────────┐
         │   LLM 实体关系抽取    │                      │   向量嵌入生成       │
         │   (Qwen/DeepSeek)   │                      │   (BGE-M3)          │
         └─────────┬───────────┘                      └─────────┬───────────┘
                   ↓                                            ↓
         ┌─────────────────────┐                      ┌─────────────────────┐
         │   图数据库存储        │                      │   向量数据库存储     │
         │   (Neo4j/自建)       │                      │   (Milvus)          │
         └─────────┬───────────┘                      └─────────┬───────────┘
                   ↓                                            ↓
         ┌─────────────────────┐                      ┌─────────────────────┐
         │   Leiden图聚类       │                      │   语义检索           │
         │   社区划分与摘要     │                      │   Top-K 相似文档     │
         └─────────┬───────────┘                      └─────────────────────┘
                   ↓
         ┌─────────────────────┐
         │   社区摘要存储        │
         └─────────┬───────────┘
                   ↓
    ┌──────────────┴──────────────┐
    ↓                              ↓
┌────────────────┐         ┌────────────────┐
│  Local Search  │         │  Global Search │
│  实体精确查询   │         │  全局综合推理   │
└────────────────┘         └────────────────┘
```

### 4.2 实体关系 Schema

```json
{
  "entities": {
    "Person": ["name", "relation_to_user", "first_mention_date"],
    "Event": ["name", "date", "emotion", "significance"],
    "Place": ["name", "type", "frequency", "coordinates", "address"],
    "Emotion": ["type", "intensity", "trigger"],
    "Topic": ["name", "category"]
  },
  "relations": {
    "RELATED_TO": "Person ↔ Person",
    "HAPPENED_AT": "Event → Place",
    "TRIGGERED": "Event → Emotion",
    "PARTICIPATED": "Person → Event",
    "MENTIONED_IN": "Entity → DiaryEntry"
  }
}
```

### 4.3 AI 伴侣架构
*   **长期记忆层**: 结合向量库（语义检索）与图数据库（关系推理），支持深度上下文检索。
*   **人设层**: 在 Prompt 系统中引入可配置的"人设模板"，根据用户选择动态注入。
*   **主动触发层**: 基于图谱情感变化趋势的规则引擎，触发主动关怀事件。

### 4.4 技术选型建议

| 组件 | 选型方案 | 说明 |
| :--- | :--- | :--- |
| **图数据库** | Neo4j / 自建内存图 | 小规模可用内存图，大规模用 Neo4j |
| **图聚类** | Leiden / Louvain | 社区发现算法 |
| **实体抽取** | LLM (Qwen/DeepSeek) | 使用大模型进行实体关系抽取 |
| **向量库** | Milvus (保持现有) | 继续用于语义相似检索 |
| **缓存层** | Redis (保持现有) | 缓存热门社区摘要 |

---

## 5. 📅 里程碑计划

### Phase 1 (W1-W4): "时空足迹" & GraphRAG 基建
- [ ] 日记地理位置关联（地图选点/自动定位） (P0)
- [ ] 常用地点与重要地点管理 (P0)
- [ ] 实体关系抽取 Prompt 设计与调优 (P1)
- [ ] 图数据存储方案实现（轻量级内存图 or Neo4j）
- [ ] Leiden 图聚类与社区摘要生成
- [ ] Local/Global 双模式查询实现

### Phase 2 (W5-W8): AI 伴侣升级
- [ ] 伴侣人设系统（可选人设+自定义）
- [ ] 记忆殿堂可视化（时间线+图谱展示）
- [ ] 基于图谱的周期报告生成
- [ ] 主动关怀触发机制

### Phase 3 (W9-W12): 创作者生态
- [ ] 场景创作器 (P1)
- [ ] 场景审核流程
- [ ] 评分与榜单系统
- [ ] 创作者认证

### Phase 4 (W13-W16): 社交扩展
- [ ] 灵魂部落基础功能 (P1)
- [ ] 图谱相似度匹配算法
- [ ] 部落情景室
- [ ] 匿名树洞

---

## 6. 📊 成功指标 (Success Metrics)

| 指标 | 目标 | 说明 |
| :--- | :--- | :--- |
| **多跳问答满意度** | 80%+ | 用户对复杂问答结果的满意比例 |
| **AI 伴侣互动频率** | 日均 3 次/活跃用户 | 用户与 AI 的平均对话次数 |
| **图谱覆盖率** | 70%+ | 日记内容被抽取为图谱实体的比例 |
| **场景创作数** | 100+/月 | 用户投稿的新场景数量 |
| **部落活跃率** | 60%+ | 部落内周活跃成员比例 |
| **用户留存率** | D7 40%+, D30 25%+ | 标准留存指标 |

---

## 7. ⚠️ 风险与缓解策略

| 风险类型 | 风险描述 | 缓解策略 |
| :--- | :--- | :--- |
| **技术风险** | 实体抽取准确度不足 | 多轮迭代 Prompt，结合规则校验 |
| **性能风险** | 图谱查询耗时过长 | 社区预计算+缓存，限制遍历深度 |
| **成本风险** | LLM 实体抽取 Token 消耗高 | 批量处理，增量更新，仅新日记触发抽取 |
| **内容风险** | UGC 场景质量参差不齐 | 完善审核流程，引入创作者等级制度 |
| **隐私风险** | 图谱可能泄露更多关联信息 | 图谱严格绑定用户，不与他人共享原始图谱 |

---

## 8. 💡 未来展望 (v4.0+)

*   **跨用户图谱联邦**: 在保护隐私的前提下，发现不同用户图谱间的"交汇点"（如同校、同事），提供更精准匹配。
*   **AI 绘画日记**: 根据日记内容生成艺术化的情绪画作，形成独特的"情感画廊"。
*   **人生回忆录自动生成**: 基于人生图谱，AI 自动撰写用户的"回忆录"或"年度总结"。
*   **冥想引导**: AI 根据图谱中的情绪状态，提供个性化的冥想与正念引导。
*   **灵魂继承**: 用户可设置"数字遗嘱"，将 AI 伴侣及图谱传承给指定的人。

---

*文档版本: v3.0 Draft*  
*更新日期: 2026年1月19日*  
*产品经理: AI Assistant*  
*开发负责人: Aseubel*
