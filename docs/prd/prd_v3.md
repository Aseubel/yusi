# 产品需求文档 (PRD): "Yusi - 灵魂叙事" (v3.0)

## 项目

Yusi (v3.0) - Soul Graph

## 产品定义

**人不被行为标签所定义，记忆使人成型。**

我们常说了解一个人，却往往只是记住了几个标签——"他是个温柔的人"、"她很果断"。但这些标签真的能代表一个人吗？

当我们想象朋友在某个具体情境下会如何选择时，我们不会用"温柔"或"果断"来思考，而是他会做什么、说什么、怎样行动。这才是真正的理解。

Yusi 相信，记忆使人成型。你一生中做出的每一个选择，经历过的每一段故事，在无形中塑造了今天的你。

**Yusi 的使命**：让每个人都能静下心来审视自己的内心，记录那些重要的选择和时刻；也让他人有机会看见真实的你——不是标签化的你，而是具体情境中做出具体选择的你。

## 核心愿景

从"向量检索"进化到"图谱理解"。通过 **GraphRAG 知识图谱技术**重构 AI 的"记忆"与"理解"能力，让 AI 真正"读懂"用户的人生故事，实现从"语义相似匹配"到"关系推理理解"的跨越。

---

## 1. 🎯 v3.0 战略目标

- **深度理解 (Deep Understanding)**: 引入 GraphRAG，将用户日记从"文本碎片"转化为"人生图谱"，让 AI 能进行多跳推理。
- **AI进化 (AI Evolution)**: 升级"AI知己"为具有记忆、性格、成长轨迹的"灵魂伴侣"，实现真正的陪伴感。
- **体验升级 (Experience Upgrade)**: 日记富文本编辑，长记忆完整架构实现真正的"知己"对话。

---

## 2. 🚀 新增功能范围 (New Epics)

### Epic 5: "时空足迹" (Spatial Narrative) - Geo-Context

**目标**: 引入地理位置维度，支持地图选点与常用位置，为 GraphRAG 提供关键的空间上下文。

| ID       | 功能特性       | 描述                                                                 | 优先级 | 状态     |
| :------- | :------------- | :------------------------------------------------------------------- | :----- | :------- |
| **F5.1** | 日记地理关联   | 支持写日记时添加地理位置（自动定位/地图选点/搜索POI）                 | P0     | ✅ 已完成 |
| **F5.2** | 常用与重要地点 | 用户可管理"常用地点"及定义"重要地点"，辅助实体关系构建与消歧          | P0     | ✅ 已完成 |
| **F5.3** | 足迹地图       | 在地图上可视化展示用户日记足迹，支持按时间、地点、情感维度聚类查看    | P1     | 🔧 已移除 |

### Epic 6: "人生图谱" (Life Graph) - 基于 GraphRAG

**目标**: 利用知识图谱技术，让 AI 真正理解用户的人生故事。

| ID       | 功能特性     | 描述                                                              | 优先级 | 状态     |
| :------- | :----------- | :---------------------------------------------------------------- | :----- | :------- |
| **F6.1** | 实体自动抽取 | AI 从日记中自动提取关键实体（人物、地点、事件、情绪、物品等）      | P1     | ✅ 已完成 |
| **F6.2** | 关系图谱构建 | 基于实体间的共现和语义分析，自动推断并建立关系边                   | P1     | ✅ 已完成 |
| **F6.3** | 多跳推理问答 | AI 可回答复杂问题，通过图谱遍历进行多跳推理                        | P1     | ✅ 已完成 |
| **F6.4** | 人生时间线   | 可视化展示用户人生重要节点的时间线                                 | P2     | ✅ 已完成 |
| **F6.5** | 社区洞察     | 通过图聚类算法识别用户生活中的"社区"（工作圈、朋友圈、家庭）       | P2     | ✅ 已完成 |
| **F6.6** | 情感图谱     | 追踪用户情绪随时间和事件的变化，识别情绪触发点                     | P2     | ✅ 已完成 |

### Epic 7: "灵魂伴侣 2.0" (Evolved AI Companion)

**目标**: 将 AI 从"分析工具"升级为具有个性与成长的"灵魂伴侣"。

| ID       | 功能特性   | 描述                                                          | 优先级 | 状态     |
| :------- | :--------- | :------------------------------------------------------------ | :----- | :------- |
| **F7.1** | 伴侣人设   | 用户可选择 AI 伴侣的性格基调（温暖治愈型、理性分析型等）      | P1     | 📋 待开发 |
| **F7.2** | 记忆殿堂   | 基于人生图谱展示与用户的互动时间线、关键记忆节点              | P1     | 📋 待开发 |
| **F7.3** | 周期报告   | AI 每周/每月自动生成"灵魂报告"，包含情绪波动、关键事件回顾    | P2     | 📋 待开发 |
| **F7.4** | 主动关怀   | AI 检测到持续负面情绪时主动发起温暖对话                       | P2     | 📋 待开发 |
| **F7.5** | 纪念日提醒 | 从图谱中识别重要纪念日，主动送上关怀与回忆                    | P2     | 📋 待开发 |

### Epic 8: "长记忆架构" (Long Memory Architecture)

**目标**: 实现完整的 AI 长记忆系统，让 AI 真正"记住"用户的一切，实现深度知己对话。

| ID       | 功能特性       | 描述                                                              | 优先级 | 状态     |
| :------- | :------------- | :---------------------------------------------------------------- | :----- | :------- |
| **F8.1** | 记忆分层存储   | 短期记忆（会话级）、中期记忆（近期重要事件）、长期记忆（人生图谱） | P0     | 📋 待开发 |
| **F8.2** | 记忆检索增强   | 基于用户问题动态检索相关记忆，融合图谱+向量双重检索               | P0     | 📋 待开发 |
| **F8.3** | 记忆压缩摘要   | 对历史对话进行智能压缩，保留关键信息，降低 Token 消耗             | P1     | 📋 待开发 |
| **F8.4** | 记忆遗忘机制   | 模拟人类遗忘曲线，自动衰减不重要记忆，强化重要记忆               | P1     | 📋 待开发 |
| **F8.5** | 对话上下文感知 | AI 在对话中主动引用用户过往经历，实现"我记得你说过..."           | P2     | 📋 待开发 |

### Epic 9: "富文本日记" (Rich Text Diary)

**目标**: 升级日记编辑体验，支持富文本格式，让用户更自由地表达。

| ID       | 功能特性     | 描述                                                              | 优先级 | 状态     |
| :------- | :----------- | :---------------------------------------------------------------- | :----- | :------- |
| **F9.1** | 富文本编辑器 | 支持粗体、斜体、下划线、标题、列表、引用等格式                    | P0     | 📋 待开发 |
| **F9.2** | 图片插入     | 支持在日记中插入图片，图片可选择是否加密存储                      | P1     | 📋 待开发 |
| **F9.3** | Markdown支持 | 支持 Markdown 语法快速编辑，实时预览                              | P1     | 📋 待开发 |
| **F9.4** | 模板系统     | 提供日记模板（感恩日记、情绪日记、复盘日记等）                    | P2     | 📋 待开发 |

---

## 3. 🛠 现有功能优化 (Optimizations)

### 3.1 灵魂匹配升级

| 功能               | 描述                                           | 优先级 | 状态     |
| :----------------- | :--------------------------------------------- | :----- | :------- |
| 图谱相似度匹配     | 匹配算法升级为"图谱结构相似度"                 | P1     | 📋 待开发 |
| 匹配理由可视化     | 向用户展示 AI 推荐的"图谱连接点"               | P2     | 📋 待开发 |

### 3.2 情景室优化

| 功能             | 描述                                           | 优先级 | 状态     |
| :--------------- | :--------------------------------------------- | :----- | :------- |
| 实时进度可视化   | 显示每个成员的提交状态                         | P1     | ✅ 已完成 |
| 历史回顾增强     | 支持按场景类型、时间范围筛选                   | P2     | 📋 待开发 |
| 分享卡片         | 生成可分享的精美分析报告卡片                   | P2     | 📋 待开发 |

### 3.3 隐私与安全增强

| 功能         | 描述                                           | 优先级 | 状态     |
| :----------- | :--------------------------------------------- | :----- | :------- |
| 密钥助记词   | 自定义密钥模式下支持12词助记词备份             | P1     | 📋 待开发 |
| 图谱隐私     | 人生图谱仅在服务端处理，自定义密钥模式下受保护 | P1     | 📋 待开发 |

### 3.4 性能与体验优化

| 功能         | 描述                                           | 优先级 | 状态     |
| :----------- | :--------------------------------------------- | :----- | :------- |
| 离线模式     | 支持离线撰写日记，上线后自动同步               | P2     | 📋 待开发 |
| 多端同步     | 提供 PWA，实现日记、聊天记录的多端同步         | P2     | 📋 待开发 |
| 夜间模式增强 | 支持手动切换夜间模式                           | P2     | ✅ 已完成 |

---

## 4. 📐 技术架构

### 4.1 GraphRAG 架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        用户日记输入                              │
└─────────────────────────────┬───────────────────────────────────┘
                              ↓
          ┌───────────────────┴───────────────────┐
          ↓                                         ↓
┌─────────────────────┐                 ┌─────────────────────┐
│   LLM 实体关系抽取   │                 │   向量嵌入生成       │
│   (Qwen/DeepSeek)   │                 │   (BGE-M3)          │
└─────────┬───────────┘                 └─────────┬───────────┘
          ↓                                       ↓
┌─────────────────────┐                 ┌─────────────────────┐
│   图数据库存储        │                 │   向量数据库存储     │
│   (MySQL)           │                 │   (Milvus)          │
└─────────┬───────────┘                 └─────────┬───────────┘
          ↓                                       ↓
┌─────────────────────┐                 ┌─────────────────────┐
│   Leiden 图聚类      │                 │   语义检索           │
│   社区划分与摘要     │                 │   Top-K 相似文档     │
└─────────┬───────────┘                 └─────────────────────┘
          ↓
┌─────────────────────┐
│   Local/Global 查询  │
└─────────────────────┘
```

### 4.2 长记忆架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        用户对话输入                              │
└─────────────────────────────┬───────────────────────────────────┘
                              ↓
                    ┌─────────────────┐
                    │   意图理解       │
                    │   (LLM)         │
                    └────────┬────────┘
                             ↓
          ┌──────────────────┴──────────────────┐
          ↓                                      ↓
┌─────────────────────┐              ┌─────────────────────┐
│   记忆检索           │              │   图谱检索           │
│   (向量相似度)       │              │   (关系遍历)         │
└─────────┬───────────┘              └─────────┬───────────┘
          ↓                                      ↓
          └──────────────────┬──────────────────┘
                             ↓
                    ┌─────────────────┐
                    │   记忆融合       │
                    │   (重排序+压缩)  │
                    └────────┬────────┘
                             ↓
                    ┌─────────────────┐
                    │   上下文构建     │
                    │   (Prompt组装)   │
                    └────────┬────────┘
                             ↓
                    ┌─────────────────┐
                    │   AI 回复生成    │
                    └─────────────────┘
```

### 4.3 记忆分层模型

| 层级     | 存储内容                     | 保留时长   | 存储方式     |
| :------- | :--------------------------- | :--------- | :----------- |
| **短期** | 当前会话对话历史             | 会话结束   | Redis        |
| **中期** | 近期重要事件摘要             | 30天       | MySQL + 向量 |
| **长期** | 人生图谱、关键记忆节点       | 永久       | MySQL + 图谱 |

### 4.4 技术选型

| 组件         | 选型方案          | 说明                       |
| :----------- | :---------------- | :------------------------- |
| **图数据库** | MySQL             | 关系型存储，简化运维       |
| **图聚类**   | Leiden            | 社区发现算法               |
| **实体抽取** | LLM (Qwen)        | 大模型实体关系抽取         |
| **向量库**   | Milvus            | 语义相似检索               |
| **缓存层**   | Redis             | 短期记忆、热门数据缓存     |
| **富文本**   | TipTap / Slate    | 现代富文本编辑器框架       |

---

## 5. 📅 里程碑计划

### Phase 1: 时空足迹 & GraphRAG 基建

- [x] 日记地理位置关联
- [x] 常用地点与重要地点管理
- [x] 实体关系抽取 Prompt 设计与调优
- [x] 图数据存储方案实现（MySQL）
- [x] Leiden 图聚类与社区摘要生成
- [x] Local/Global 双模式查询实现
- [x] 社区洞察（图聚类算法识别生活圈）
- [x] 情感图谱（情绪追踪与触发点识别）
- [ ] 足迹地图可视化修复

### Phase 2: 长记忆架构 & 富文本

- [ ] 记忆分层存储实现
- [ ] 记忆检索增强（向量+图谱）
- [ ] 记忆压缩摘要
- [ ] 对话上下文感知
- [ ] 富文本编辑器集成
- [ ] 图片插入与加密存储

### Phase 3: AI 伴侣升级

- [ ] 伴侣人设系统
- [ ] 记忆殿堂可视化
- [ ] 基于图谱的周期报告生成
- [ ] 主动关怀触发机制

---

## 6. 📊 成功指标

| 指标                | 目标               | 说明                           |
| :------------------ | :----------------- | :----------------------------- |
| **多跳问答满意度**  | 80%+               | 用户对复杂问答结果的满意比例   |
| **AI 伴侣互动频率** | 日均 3 次/活跃用户 | 用户与 AI 的平均对话次数       |
| **图谱覆盖率**      | 70%+               | 日记内容被抽取为图谱实体的比例 |
| **记忆召回准确率**  | 85%+               | AI 正确引用用户过往经历的比例  |
| **用户留存率**      | D7 40%+, D30 25%+  | 标准留存指标                   |

---

## 7. ⚠️ 风险与缓解策略

| 风险类型     | 风险描述              | 缓解策略                             |
| :----------- | :-------------------- | :----------------------------------- |
| **技术风险** | 实体抽取准确度不足    | 多轮迭代 Prompt，结合规则校验        |
| **性能风险** | 图谱查询耗时过长      | 社区预计算+缓存，限制遍历深度        |
| **成本风险** | LLM Token 消耗高      | 记忆压缩、增量更新、批量处理         |
| **存储风险** | 富文本/图片存储膨胀   | 图片压缩、CDN、定期清理              |
| **隐私风险** | 图谱可能泄露关联信息  | 图谱严格绑定用户，不与他人共享       |

---

## 8. 💡 未来展望 (v4.0+)

- **跨用户图谱联邦**: 在保护隐私的前提下，发现不同用户图谱间的"交汇点"
- **AI 绘画日记**: 根据日记内容生成艺术化的情绪画作
- **人生回忆录自动生成**: 基于人生图谱，AI 自动撰写用户的"回忆录"
- **冥想引导**: AI 根据图谱中的情绪状态，提供个性化的冥想引导
- **场景工坊**: UGC 创作者生态，用户可投稿、评分、认证场景

---

_文档版本: v3.0_  
_更新日期: 2026年2月15日_  
_产品经理: AI Assistant_  
_开发负责人: Aseubel_
